import Utils from '../utils'
import rlp, { dataTree, length, padEven, uint } from './rlp'

test('lib/rlp/padEven', () => {
  expect(padEven('123')).toBe('0123')
})

test('lib/rlp/uint', () => {
  expect(uint(10)).toBe('0a')
})

test('lib/rlp/length', () => {
  expect(length(50, 20)).toBe('46')
  expect(length(58, 20)).toBe('4c3a')
})

test('lib/rlp/dataTree', () => {
  expect(dataTree('0x212412')).toBe('83212412')
  expect(dataTree('0x00112233445566778899aabbccddeeff')).toBe(
    '9000112233445566778899aabbccddeeff'
  )
  expect(
    dataTree([
      '0x00112233',
      '0x00',
      '0x44',
      '0x55',
      '0xf0',
      '0xff',
      ['0x66'],
      ['0x77', '0x88'],
      '0x',
      '0x',
      '0x99aabb'
    ])
  ).toBe('d8840011223300445581f081ffc166c377818880808399aabb')
})

test('lib/rlp/encode', () => {
  expect(rlp.encode('a')).toBe('0x61')
  expect(rlp.encode('dog')).toBe('0x83646f67')
  expect(
    rlp.encode(
      'zoo255zoo255zzzzzzzzzzzzssssssssssssssssssssssssssssssssssssssssssssss'
    )
  ).toBe(
    '0xb8467a6f6f3235357a6f6f3235357a7a7a7a7a7a7a7a7a7a7a7a73737373737373737373737373737373737373737373737373737373737373737373737373737373737373737373'
  )
  expect(rlp.encode('0x212412')).toBe('0x83212412')
  expect(rlp.encode('0x00112233445566778899aabbccddeeff')).toBe(
    '0x9000112233445566778899aabbccddeeff'
  )
  expect(
    rlp.encode([
      '0x00112233',
      '0x00',
      '0x44',
      '0x55',
      '0xf0',
      '0xff',
      ['0x66'],
      ['0x77', '0x88'],
      '0x',
      '0x',
      '0x99aabb'
    ])
  ).toBe('0xd8840011223300445581f081ffc166c377818880808399aabb')
  expect(rlp.encode([[], [[]], [[], [[]]]])).toBe('0xc7c0c1c0c3c0c1c0')
  expect(
    rlp.encode([
      [
        [
          [],
          [
            '0x',
            [
              '0x1fbec83034bd56b4db7a0264e434ad2cf326c84c8a9c0f63f84da4d5e06f4e76',
              '0x'
            ]
          ]
        ],
        [
          ['0x29b92700', '0x9328d55ccb3fce531f199382339f0e576ee840b1'],
          ['0x0ee6b280', '0x9328d55ccb3fce531f199382339f0e576ee840b2']
        ],
        '0x',
        '0x'
      ],
      []
    ])
  ).toBe(
    '0xf863f860e6c0e480e2a01fbec83034bd56b4db7a0264e434ad2cf326c84c8a9c0f63f84da4d5e06f4e7680f6da8429b92700949328d55ccb3fce531f199382339f0e576ee840b1da840ee6b280949328d55ccb3fce531f199382339f0e576ee840b28080c0'
  )
  expect(
    rlp.encode([
      [
        '0x0a',
        '0x00000000000000000000000121321432423534534534',
        '0x',
        '0x',
        '0x2710',
        '0x0a',
        '0x'
      ],
      '0x01'
    ])
  ).toBe(
    '0xe1df0a960000000000000000000000012132143242353453453480808227100a8001'
  )
})

test('lib/rlp/decode', () => {
  expect(rlp.decode('')).toEqual([])
  expect(rlp.decode('0x83212412')).toEqual('0x212412')
  expect(rlp.decode('0x9000112233445566778899aabbccddeeff')).toEqual(
    '0x00112233445566778899aabbccddeeff'
  )
  expect(
    rlp.decode('0xd8840011223300445581f081ffc166c377818880808399aabb')
  ).toEqual([
    '0x00112233',
    '0x00',
    '0x44',
    '0x55',
    '0xf0',
    '0xff',
    ['0x66'],
    ['0x77', '0x88'],
    '0x',
    '0x',
    '0x99aabb'
  ])
  expect(
    rlp.decode('0xd8840011223300445581f081ffc166c37781888080839aabb')
  ).toEqual([])
  expect(rlp.decode('0xc7c0c1c0c3c0c1c0')).toEqual([[], [[]], [[], [[]]]])
  expect(rlp.decode('0x01')).toEqual('0x01')
  expect(
    Utils.hexToUtf8(
      rlp
        .decode(
          '0xb74c6f72656d20697073756d20646f6c6f722073697420616d65742c20636f6e7365637465747572206164697069736963696e6720656c69'
        )
        .toString()
    )
  ).toEqual('Lorem ipsum dolor sit amet, consectetur adipisicing eli')
  expect(
    rlp.decode(
      '0xf90200cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376cf84617364668471776572847a786376'
    )
  ).toEqual([
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376'],
    ['0x61736466', '0x71776572', '0x7a786376']
  ])

  expect(rlp.encode([[[], [], ['0x1234534513453155', '0x']], []])).toEqual(
    '0xcfcdc0c0ca88123453451345315580c0'
  )
  expect(
    rlp.decode(
      '0xf860e6c0e480e2a01fbec83034bd56b4db7a0264e434ad2cf326c84c8a9c0f63f84da4d5e06f4e7680f6da8429b92700949328d55ccb3fce531f199382339f0e576ee840b1da840ee6b280949328d55ccb3fce531f199382339f0e576ee840b28080'
    )
  ).toEqual([
    [
      [],
      [
        '0x',
        [
          '0x1fbec83034bd56b4db7a0264e434ad2cf326c84c8a9c0f63f84da4d5e06f4e76',
          '0x'
        ]
      ]
    ],
    [
      ['0x29b92700', '0x9328d55ccb3fce531f199382339f0e576ee840b1'],
      ['0x0ee6b280', '0x9328d55ccb3fce531f199382339f0e576ee840b2']
    ],
    '0x',
    '0x'
  ])
  expect(
    rlp.decode(
      '0xf83ef83bc1c0f6da8429b92700949328d55ccb3fce531f199382339f0e576ee840b1da840ee6b280949328d55ccb3fce531f199382339f0e576ee840b28080c0'
    )
  ).toEqual([
    [
      [[]],
      [
        ['0x29b92700', '0x9328d55ccb3fce531f199382339f0e576ee840b1'],
        ['0x0ee6b280', '0x9328d55ccb3fce531f199382339f0e576ee840b2']
      ],
      '0x',
      '0x'
    ],
    []
  ])
  expect(
    rlp.decode(
      '0xf863f860e6c0e480e2a01fbec83034bd56b4db7a0264e434ad2cf326c84c8a9c0f63f84da4d5e06f4e7680f6da8429b92700949328d55ccb3fce531f199382339f0e576ee840b1da840ee6b280949328d55ccb3fce531f199382339f0e576ee840b28080c0'
    )
  ).toEqual([
    [
      [
        [],
        [
          '0x',
          [
            '0x1fbec83034bd56b4db7a0264e434ad2cf326c84c8a9c0f63f84da4d5e06f4e76',
            '0x'
          ]
        ]
      ],
      [
        ['0x29b92700', '0x9328d55ccb3fce531f199382339f0e576ee840b1'],
        ['0x0ee6b280', '0x9328d55ccb3fce531f199382339f0e576ee840b2']
      ],
      '0x',
      '0x'
    ],
    []
  ])
  expect(
    rlp.decode(
      '0xf888f885f84ae480e2a05f961959398c7f059ff492c568a77e43200157514095b7f4a60788d8a2d6013d80e480e2a01fbec83034bd56b4db7a0264e434ad2cf326c84c8a9c0f63f84da4d5e06f4e7680f6da8429b92700949328d55ccb3fce531f199382339f0e576ee840b1da840ee6b280949328d55ccb3fce531f199382339f0e576ee840b28080c0'
    )
  ).toEqual([
    [
      [
        [
          '0x',
          [
            '0x5f961959398c7f059ff492c568a77e43200157514095b7f4a60788d8a2d6013d',
            '0x'
          ]
        ],
        [
          '0x',
          [
            '0x1fbec83034bd56b4db7a0264e434ad2cf326c84c8a9c0f63f84da4d5e06f4e76',
            '0x'
          ]
        ]
      ],
      [
        ['0x29b92700', '0x9328d55ccb3fce531f199382339f0e576ee840b1'],
        ['0x0ee6b280', '0x9328d55ccb3fce531f199382339f0e576ee840b2']
      ],
      '0x',
      '0x'
    ],
    []
  ])
})

test('decode', () => {
  expect(
    rlp.decode(
      '0xf83fe704960000e21391aa1ccacb7c8e7e2e645bb2cf811fe1e30d8080865af3107a40008405f5e10080960000d28eb0154a96f4af6e631766939593554c7e5577'
    )
  ).toEqual([
    [
      '0x04',
      '0x0000e21391aa1ccacb7c8e7e2e645bb2cf811fe1e30d',
      '0x',
      '0x',
      '0x5af3107a4000',
      '0x05f5e100',
      '0x'
    ],
    '0x0000d28eb0154a96f4af6e631766939593554c7e5577'
  ])
})
